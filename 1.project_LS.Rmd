---
title: 'Project 1: Areal data analysis'
author: "Laura Sudupe. email: laura.medinilla@kaust.eu.sa"
date: "10/1/2022"
geometry: margin=2cm
fontsize: 12pt
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include =FALSE}
library(sf)
library(epitools)
library(SpatialEpi)
library(spData)
library(ggplot2)
library(leaflet)
library(spdep)
library(INLA)
```


# New Zeland aeral data analysis


### Abstract

**This project will be focused on analyzing New Zeland (NZ) aeral data using Rstudio. The project is the first one of the three we need to prepare for the <a href = "https://www.paulamoraga.com/book-gds/index.html">STAT394 course</a>. In the first section we are going to describe NZ data and briefly explain areal data type. Next, we will focus on preparing the data for the statistical modelling. After this, we are going to go through the results, understanding the meaning and finally a short discussion of the project.**

```{r echo=F, warning= F, message=F}
#opts_chunk$set(message = FALSE, warning = FALSE, error = FALSE, tidy = FALSE, cache = FALSE,results = 'asis' )
```


### Introduction

Aeral data

NZ data

STAT394 course, INLA modelling

### Data

```{r data, include=FALSE}
data("nz")
class(nz)
names(nz)
head(nz)
?nz
```


Statistical description of the data
Variables of the data
Visual plots of the data

```{r prepare_data, include=FALSE}
nz$Island <- as.factor(nz$Island)
##https://rdrr.io/cran/SpatialEpi/src/R/expected.R
nz$side <- as.integer(ifelse(nz$Island == "North", 0, ifelse(nz$Island == "South", 1, "no data")))
####sex ratio transform 0 woman, 1 man
nz$Sex_ratio
#female:male
nz$sex <- ifelse(nz$Sex_ratio == 1, 'same', ifelse(nz$Sex_ratio > 1, 'female', "male"))

###expected cases
##area: name of the area
##Y: observed number of cases, in my case, median income
##E: expected number of cases in my case, expected median income
##quiero que dependa de
##population in each 
##SMR in each area
nz$e <- expected(population = nz$Population, cases = nz$Median_income, n.strata = 2)
nz$SMR <- nz$Median_income / nz$e
```


```{r summary, message=FALSE, echo=F}
if (requireNamespace("sf", quietly = TRUE)) {
  library(sf)
  summary(nz)
  plot(nz)
}
```


```{r spatial, message=FALSE, echo=F}
###Data preparation

# convert to SpatialPolygonsDataFrame
map_spdf <- as_Spatial(nz, IDs = TRUE) ##EL BUENO
class(map_spdf)
#plot(map_spdf)

#https://blog.exploratory.io/making-maps-for-new-zealand-regions-and-territories-in-r-4400333df644
wgs84 = '+proj=longlat +datum=WGS84'
nz_region <- spTransform(map_spdf, CRS(wgs84))
nz_region@data[["Population"]] <- as.integer(nz_region@data[["Population"]])

```


### Analyses

Data modelling. Explain what is going on

### Results and Interpretation

Results statistical

Visual plots

### Discussion section

What can I do better
What I learned
General comment

